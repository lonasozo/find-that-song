<!DOCTYPE html>
<html>
  <head>
    <title>Your Top Artists</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../public/css/artists.css">
    <% 
    // Helper function to extract Spotify ID from URL
    function extractSpotifyId(url) {
      if (!url) return '';
      const parts = url.split('/');
      return parts[parts.length - 1].split('?')[0];
    }
    %>
    <style>
      .copy-seed {
        cursor: pointer;
        background: rgba(30, 215, 96, 0.2);
        border-radius: 4px;
        padding: 1px 4px;
        font-size: 0.65rem;
        display: inline-flex;
        align-items: center;
        transition: all 0.2s ease;
        margin-top: 3px;
        margin-bottom: 3px;
      }
      
      .artist-name-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      
      .copy-seed:hover {
        background: rgba(30, 215, 96, 0.3);
      }
      
      .copy-seed.copied {
        background: rgba(30, 215, 96, 0.5);
      }
      
      .copy-icon {
        margin-right: 3px;
        font-size: 0.7rem;
      }
      
      @media (max-width: 768px) {
        .copy-seed {
          font-size: 0.55rem;
          padding: 1px 3px;
        }
      }
    </style>
  </head>
  <body>
    <div class="artists-container">
      <header>
        <h1>Your Top Artists</h1>
        <%- include('partials/nav', { access_token }) %>
      </header>
      
      <div class="artists-grid">
        <% artists.forEach((artist, index) => { %>
          <% const artistId = extractSpotifyId(artist.external_urls.spotify); %>
          <div class="artist-card" data-artist-id="<%= artistId %>">
            <div class="artist-rank"><%= index + 1 %></div>
            <img src="<%= artist.images[1]?.url || artist.images[0]?.url %>" alt="<%= artist.name %>" class="artist-img" />
            <div class="artist-name-container">
              <a href="<%= artist.external_urls.spotify %>" target="_blank">
                <div class="artist-name"><%= artist.name %></div>
              </a>
              <div class="copy-seed" data-seed="<%= artistId %>" title="Click to copy seed ID: <%= artistId %>">
                <span class="seed-value">Seed</span>
              </div>
            </div>
            <div class="artist-genres"><%= artist.genres.slice(0, 3).join(', ') %></div>
          </div>
        <% }); %>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Add click event to all copy-seed elements
        const seedElements = document.querySelectorAll('.copy-seed');
        
        seedElements.forEach(element => {
          element.addEventListener('click', function(e) {
            e.preventDefault(); // Prevent link navigation
            const seedId = this.getAttribute('data-seed');
            
            // Copy to clipboard
            navigator.clipboard.writeText(seedId).then(() => {
              // Visual feedback
              this.classList.add('copied');
              
              const originalText = this.querySelector('.seed-value').textContent;
              this.querySelector('.seed-value').textContent = 'Copied!';
              
              // Reset after 2 seconds
              setTimeout(() => {
                this.classList.remove('copied');
                this.querySelector('.seed-value').textContent = originalText;
              }, 2000);
            }).catch(err => {
              console.error('Failed to copy text: ', err);
            });
          });
        });
      });
    </script>
  </body>
</html>
