<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playlist Generator - Find That Song</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/playlist-generator.css">
  <script>
    // Check for dark mode preference
    if (localStorage.getItem('theme') === 'dark' || 
        (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.setAttribute('data-theme', 'dark');
    } else {
        document.documentElement.setAttribute('data-theme', 'light');
    }
  </script>
  <style>
    /* Custom styling for multi-select dropdown */
    select[multiple] {
      height: auto;
      min-height: 100px;
      background-image: none;
      padding: 8px;
    }
    select[multiple] option {
      padding: 8px;
      margin-bottom: 3px;
      border-radius: 4px;
      background-color: #f0f0f0;
      color: #333;
    }
    select[multiple] option:checked {
      background-color: #1DB954;
      color: white;
    }
    .genres-hint {
      display: block;
      margin-top: 5px;
      font-size: 0.8em;
      color: #777;
    }
  </style>
</head>
<body>
  <div class="generator-container">
    <header>
      <h1>Playlist Generator</h1>
    </header>

    <div class="generator-form-container">
      <div class="generate-playlist-container">
        <h1>Generate a Custom Playlist</h1>
        <p class="section-description">Create a new playlist based on your music preferences.</p>

        <form id="playlist-form" action="/create-playlist" method="post" class="playlist-form">
            <input type="hidden" name="access_token" value="<%= access_token %>">
            
            <div class="form-group">
                <label for="playlist_name">Playlist Name</label>
                <input type="text" id="playlist_name" name="playlist_name" 
                       value="<%= defaultPlaylistName %>" required class="form-control">
            </div>
            
            <div class="form-group">
                <label for="playlist_description">Description (optional)</label>
                <textarea id="playlist_description" name="playlist_description" 
                          class="form-control">Discover new music with Find That Song</textarea>
            </div>
            
            <div class="form-group">
                <label>What genres would you like in your playlist?</label>
                <div class="genre-selector">
                    <select id="genres" name="genres" multiple class="form-control">
                        <optgroup label="Popular Genres">
                            <option value="pop">Pop</option>
                            <option value="rock">Rock</option>
                            <option value="hip-hop">Hip-Hop</option>
                            <option value="r-n-b">R&B</option>
                            <option value="electronic">Electronic</option>
                            <option value="dance">Dance</option>
                            <option value="indie">Indie</option>
                        </optgroup>
                        <optgroup label="Specific Genres">
                            <option value="acoustic">Acoustic</option>
                            <option value="alternative">Alternative</option>
                            <option value="ambient">Ambient</option>
                            <option value="blues">Blues</option>
                            <option value="classical">Classical</option>
                            <option value="country">Country</option>
                            <option value="folk">Folk</option>
                            <option value="funk">Funk</option>
                            <option value="heavy-metal">Heavy Metal</option>
                            <option value="house">House</option>
                            <option value="jazz">Jazz</option>
                            <option value="piano">Piano</option>
                            <option value="punk">Punk</option>
                            <option value="reggae">Reggae</option>
                            <option value="soul">Soul</option>
                        </optgroup>
                        <optgroup label="Moods">
                            <option value="chill">Chill</option>
                            <option value="happy">Happy</option>
                            <option value="party">Party</option>
                            <option value="romance">Romance</option>
                            <option value="sad">Sad</option>
                        </optgroup>
                    </select>
                    <small class="genres-hint">Tip: Press Ctrl (Cmd on Mac) to select multiple genres (max 5)</small>
                    <small class="genres-hint">If no genres are selected, popular genres will be used.</small>
                </div>
            </div>
            
            <div class="form-group">
                <label for="track_count">Number of tracks</label>
                <input type="number" id="track_count" name="track_count" min="5" max="50" value="20" class="form-control">
            </div>
            
            <div class="form-group">
                <label>Privacy</label>
                <div class="radio-options">
                    <div class="radio-option">
                        <input type="radio" id="public_true" name="public" value="true" checked>
                        <label for="public_true">Public</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="public_false" name="public" value="false">
                        <label for="public_false">Private</label>
                    </div>
                </div>
            </div>


            <div class="advanced-options visible" id="advanced-options">
              <h3>Audio Features</h3>
              <div class="feature-sliders">
                <div class="slider-group">
                  <label for="target_energy">Energy</label>
                  <input type="range" id="target_energy" name="target_energy" min="0" max="100" value="50">
                  <span class="slider-value" id="energy-value">50%</span>
                  <p class="feature-description">Energy represents intensity and activity. High energy tracks feel fast and loud.</p>
                </div>
                
                <div class="slider-group">
                  <label for="target_popularity">Popularity</label>
                  <input type="range" id="target_popularity" name="target_popularity" min="0" max="100" value="50">
                  <span class="slider-value" id="popularity-value">50%</span>
                  <p class="feature-description">Popularity indicates how well-known a track is. Higher values mean more popular songs.</p>
                </div>
                
                <div class="slider-group">
                  <label for="target_acousticness">Acousticness</label>
                  <input type="range" id="target_acousticness" name="target_acousticness" min="0" max="100" value="50">
                  <span class="slider-value" id="acousticness-value">50%</span>
                  <p class="feature-description">Acousticness represents how acoustic a track is. Higher values mean more acoustic instruments.</p>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Create Playlist</button>
            </div>
        </form>
    </div>

    <div id="loading-spinner" style="display: none; text-align: center; margin-top: 20px;">
        <div class="spinner"></div>
        <p>Creating your playlist...</p>
    </div>

    <div id="result"></div>
  </div>
</div>

<script src="/js/playlist-generator.js"></script>

<script>
    // Additional script to make form handling better
    document.addEventListener('DOMContentLoaded', function() {
        // Enhanced genre selector functionality
        const genreSelect = document.getElementById('genres');
        
        // Function to limit genre selections to 5
        if (genreSelect) {
            genreSelect.addEventListener('change', function() {
                const selectedOptions = Array.from(this.selectedOptions);
                if (selectedOptions.length > 5) {
                    alert('You can select a maximum of 5 genres.');
                    // Deselect the last option
                    selectedOptions[selectedOptions.length - 1].selected = false;
                }
            });
        }

        // Funzione per generare un numero casuale tra min e max inclusi
        function getRandomValue(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // Imposta valori casuali per gli slider al caricamento della pagina
        function setRandomSliderValues() {
            const sliders = [
                { slider: 'target_energy', value: getRandomValue(0, 100) },
                { slider: 'target_popularity', value: getRandomValue(0, 100) },
                { slider: 'target_acousticness', value: getRandomValue(0, 100) }
            ];
            
            sliders.forEach(({slider, value}) => {
                const sliderElement = document.getElementById(slider);
                const valueDisplay = document.getElementById(slider.replace('target_', '') + '-value');
                
                sliderElement.value = value;
                valueDisplay.textContent = `${value}%`;
            });
        }
        
        // Esegui l'impostazione dei valori casuali al caricamento
        setRandomSliderValues();
        
        // Set up slider value displays
        function setupSlider(sliderId, valueId) {
          const slider = document.getElementById(sliderId);
          const valueDisplay = document.getElementById(valueId);
          
          // Aggiungiamo l'event listener per l'evento 'input'
          slider.addEventListener('input', function() {
            valueDisplay.textContent = `${this.value}%`;
          });
        }
        
        // Chiamiamo la funzione setupSlider per ogni slider
        setupSlider('target_energy', 'energy-value');
        setupSlider('target_popularity', 'popularity-value');
        setupSlider('target_acousticness', 'acousticness-value');
    });
</script>

<style>
  /* ...existing styles... */

  /* Rimuoviamo gli stili per il toggle che non è più necessario */
  .advanced-options-toggle {
    display: none;
  }

  #toggle-advanced {
    display: none;
  }

  /* Modifichiamo la classe per mostrare sempre le opzioni avanzate */
  .advanced-options {
    max-height: none; /* Rimuoviamo la limitazione di altezza */
    overflow: visible; /* Rendiamo visibile il contenuto */
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px;
    background-color: rgba(255, 255, 255, 0.05);
  }

  /* Questa classe non è più necessaria ma la lasciamo per compatibilità */
  .advanced-options.visible {
    max-height: none;
    padding: 20px;
  }

  /* ...existing styles for sliders... */
</style>

</body></html>